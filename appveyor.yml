version: '{build}'

image: Visual Studio 2017
configuration: Release

before_build:
- dotnet restore

build:
  verbosity: minimal

after_test:
- dotnet test -c Release --no-build -f netcoreapp2.2 /p:CollectCoverage=true
- choco install codecov
- codecov -h
- codecov -f "CliWrap.Tests/coverage.opencover.xml"

artifacts:
- path: CliWrap\bin\$(configuration)\CliWrap*.nupkg
  name: CliWrap.nupkg

- path: CliWrap\bin\$(configuration)\CliWrap*.snupkg
  name: CliWrap.snupkg

deploy:
- provider: NuGet
  api_key:
    secure: 5VyEaGo5gRLr9HdkRFqS1enRq+K8Qarg1dzU33CE1dOmVXp43JaS2PQTNgsRHXkc
  on:
    branch: master
    appveyor_repo_tag: true
